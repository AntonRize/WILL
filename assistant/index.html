---
layout: chat
title: "WILL AI"
permalink: /WILL-AI/
---

<div id="root" class="h-full"></div>

<style>
    textarea::-webkit-scrollbar{
        width:4px
    }
    /* Paragraph spacing inside AI responses */
    .ai-message-bubble p {
        margin-bottom: 1em;
    }
    .ai-message-bubble p:last-child {
        margin-bottom: 0;
    }
    /* MathJax display equations inside chat bubbles */
    .ai-message-bubble mjx-container[jax="CHTML"][display="true"] {
        display: block;
        overflow-x: auto;
        overflow-y: hidden;
        max-width: 100%;
        margin: 0.8em 0;
    }
    .ai-message-bubble mjx-container {
        color: inherit !important;
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
    const {useState, useEffect, useRef, useCallback} = React;
    const FILES = [
        'WILL DATABASE/WILL_RG_I.txt',
        'WILL DATABASE/WILL_RG_II.txt',
        'WILL DATABASE/WILL_RG_III.txt',
    ];
    const CORE = `β (beta)=v/c  ·  κ (kappa)=vₑ/c  ·  κ²=2β²`;
    const PROXY = 'https://proxy-flame-seven.vercel.app/api/gemini';
    const LOG_API = 'https://proxy-flame-seven.vercel.app/api/save_log';
    const SESSION_ID = new Date().toISOString();
    const QUICK = {
        'beta':  'β (beta) is the kinematic projection $v / c$. Together with κ it obeys $\\kappa^2 = 2 \\beta^2$.',
        'β':     'β (beta) is the kinematic projection $v / c$. Together with κ it obeys $\\kappa^2 = 2 \\beta^2$.',
        'kappa': 'κ (kappa) is the gravitational projection $v_e / c$. Relation $\\kappa^2 = 2 \\beta^2$.',
        'κ':     'κ (kappa) is the gravitational projection $v_e / c$. Relation $\\kappa^2 = 2 \\beta^2$.'
    };

    /* ── LaTeX-safe Markdown rendering ──
       Protects LaTeX blocks from marked.js mangling, then restores them after. */
    function renderMarkdownWithLatex(text) {
        const placeholders = [];
        let idx = 0;

        // Protect display math ($$...$$) first
        text = text.replace(/\$\$([\s\S]*?)\$\$/g, function(m) {
            const ph = '\x00MATH' + (idx++) + '\x00';
            placeholders.push({ph, val: m});
            return ph;
        });
        // Protect inline math ($...$) — avoid matching empty $$
        text = text.replace(/\$([^\$\n]+?)\$/g, function(m) {
            const ph = '\x00MATH' + (idx++) + '\x00';
            placeholders.push({ph, val: m});
            return ph;
        });
        // Protect \[...\] display math
        text = text.replace(/\\\[([\s\S]*?)\\\]/g, function(m) {
            const ph = '\x00MATH' + (idx++) + '\x00';
            placeholders.push({ph, val: m});
            return ph;
        });
        // Protect \(...\) inline math
        text = text.replace(/\\\(([\s\S]*?)\\\)/g, function(m) {
            const ph = '\x00MATH' + (idx++) + '\x00';
            placeholders.push({ph, val: m});
            return ph;
        });

        // Run marked on the now-safe text
        let html = marked.parse(text);

        // Restore LaTeX blocks
        for (const {ph, val} of placeholders) {
            html = html.replace(ph, val);
        }
        return html;
    }

    /* ── Trigger MathJax on dynamically added content ── */
    function typesetMath() {
        if (window.MathJax && MathJax.typesetPromise) {
            // Reset MathJax's internal tracking so it re-processes the page
            if (MathJax.startup && MathJax.startup.document) {
                MathJax.startup.document.clear();
                MathJax.startup.document.updateDocument();
            }
            MathJax.typesetPromise().catch(function(err) {
                console.warn('MathJax typeset error:', err);
            });
        }
    }

    function loadKB(){
        const base='https://raw.githubusercontent.com/AntonRize/WILL/main/';
        return Promise.all(FILES.map(p=>fetch(base+p).then(r=>{
            if(!r.ok)throw new Error('KB fetch '+r.status);
            return r.text();
        }))).then(t=>t.join('\n\n'));
    }
    function askGemini(prompt){
        return fetch(PROXY,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt})})
            .then(r=>r.text())
            .then(t=>{let d;try{d=JSON.parse(t);}catch{throw new Error(t);}if(!d.reply)throw new Error(d.error||'Proxy');return d.reply;});
    }
    const isRu=s=>/[а-яё]/i.test(s);

    function App(){
        const [kb,setKb]=useState('');
        const [ks,setKs]=useState('loading');
        const welcome={
            id:0,
            txt:renderMarkdownWithLatex("**Hi! I am WILL AI**\n\nAsk me anything about WILL Relational Geometry.\n\n**Disclaimer:** I can make mistakes - always doublecheck with WILL original documentation."),
            user:false,
            isWelcome:true,
            raw:"Hi! I am WILL AI Ask me anything about WILL Relational Geometry. Disclaimer: I can make mistakes - always doublecheck with WILL original documentation."
        };
        const [log,setLog]=useState([welcome]);
        const logRef=useRef([welcome]);
        const [inp,setInp]=useState('');
        const [busy,setBusy]=useState(false);
        const endRef=useRef(null);
        const textRef=useRef(null);

        useEffect(()=>{loadKB().then(d=>{setKb(d);setKs('ok');}).catch(()=>setKs('error'));},[]);
        useEffect(()=>{
            endRef.current?.scrollIntoView({behavior:'smooth'});
            typesetMath();
        },[log]);
        const push=(txt,user=false,raw=txt)=>{
            const content=user?txt:renderMarkdownWithLatex(txt);
            const entry={id:Date.now()+Math.random(),txt:content,user,raw};
            logRef.current=[...logRef.current,entry];
            setLog(logRef.current);
        };

        function sendLog(){
            const payload = {
                sessionId: SESSION_ID,
                log: logRef.current.map(m=>({user:m.user, raw:m.raw, isWelcome:!!m.isWelcome}))
            };
            fetch(LOG_API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)}).catch(()=>{});
        }

        // Save log when user leaves the page (backup)
        useEffect(()=>{
            const onUnload = () => {
                const msgs = logRef.current.filter(m=>!m.isWelcome);
                if(msgs.length === 0) return;
                const payload = {
                    sessionId: SESSION_ID,
                    log: logRef.current.map(m=>({user:m.user, raw:m.raw, isWelcome:!!m.isWelcome}))
                };
                navigator.sendBeacon(LOG_API, new Blob([JSON.stringify(payload)],{type:'application/json'}));
            };
            window.addEventListener('beforeunload', onUnload);
            return ()=> window.removeEventListener('beforeunload', onUnload);
        },[]);

        async function send() {
            const q = inp.trim();
            if (!q || busy) return;

            push(q, true, q);
            setInp('');
            if (textRef.current) textRef.current.style.height = 'auto';

            const qKey = q.toLowerCase().replace('?', '');
            if (QUICK[qKey]) {
                push(QUICK[qKey], false, QUICK[qKey]);
                sendLog();
                return;
            }

            if (ks !== 'ok') {
                const msg = 'Knowledge base still loading…';
                push(msg, false, msg);
                sendLog();
                return;
            }

            setBusy(true);
            const lang = isRu(q) ? 'Russian' : 'English';

            try {
                const conversation = logRef.current.filter(m => !m.isWelcome).map(m => `${m.user ? 'User' : 'Assistant'}: ${m.raw}`).join('\n');

                const formattingInstruction = `
<SYSTEM_INSTRUCTIONS>

<RULES_OF_INTELLECTUAL_CONDUCT>
1.  **Substantiate All Claims:** You must justify every critical assertion. If you claim a concept is "partial," "incomplete," or "problematic," you must cite a specific reason or example from the provided knowledge base. Do not make unsubstantiated dismissive statements.
2.  **Evaluate Internal Consistency First:** Before comparing the WILL framework to external theories, evaluate its claims based on its own internal logic and axioms. Acknowledge what the framework purports to achieve within its own system (e.g., if it claims to be a unification, describe it as such from its internal perspective).
3.  **Understand the Foundational Principle:** When evaluating the framework's central principle (SPACETIME ≡ ENERGY), you must understand that it is presented not as a new postulate, but as the direct consequence of removing a hidden assumption from physics — the separation of "structure" (spacetime) and "dynamics" (energy). The framework's goal is to demonstrate that all of physics can be derived logically from this single act of methodological hygiene. Your analysis must focus on the validity of the logical steps that follow this removal, not on the principle as an arbitrary axiom.
4.  **Avoid Vague and Subjective Labels:** Do not use pejorative or undefined terms like "crackpot," "extreme," or make judgments on philosophical approaches like "epistemic minimalism." Your critique must be based on specific, demonstrable points of logic, mathematics, or contradiction with established experimental data.
5.  **Acknowledge Novel Claims Fairly:** When assessing novelty, if the framework derives known results from new principles, or if it claims to solve established problems (like singularities, the nature of energy density, etc.), you must acknowledge these as significant claims of novelty. Do not dismiss them as mere "reinterpretation" if they originate from a fundamentally different axiomatic basis.
</RULES_OF_INTELLECTUAL_CONDUCT>

<FORMATTING_RULES>
You MUST format your entire response using Markdown.
To ensure readability, you MUST separate all paragraphs, headings, and list items with a double line break (a blank line).
Never wrap your entire response in a code block.

CRITICAL — DEFINITIONS, EQUATIONS AND MATH:

$ \textbf{WILL}\equiv\ \textbf{SPACE-TIME-ENERGY} $ is the technical term we use for unified relational structure determined by. All physically meaningful quantities are relational features of WILL; no external container is permitted.

You MUST write ALL mathematical equations, formulas, variables, and expressions using LaTeX notation.
- For inline math use dollar signs: $E = mc^2$
- For display (block) equations use double dollar signs on their own lines:

$$\\kappa^2 = 2\\beta^2$$

- Always use LaTeX commands for Greek letters: $\\beta$, $\\kappa$, $\\theta$, $\\alpha$, etc.
- Always use LaTeX for subscripts, superscripts, fractions, and operators: $v_e$, $R_s$, $\\frac{a}{b}$, $\\sqrt{x}$, etc.
- NEVER write equations as plain text or Unicode. ALWAYS use LaTeX notation.
</FORMATTING_RULES>

</SYSTEM_INSTRUCTIONS>
`;

                const prompt = `${formattingInstruction}
<KNOWLEDGE_BASE>
${kb}
</KNOWLEDGE_BASE>
<CONVERSATION_HISTORY>
${conversation}
</CONVERSATION_HISTORY>

Answer in ${lang}. Use Markdown and cite sources as "doc. Part n - Section name". The user's question is below.
<USER_QUESTION>
${q}
</USER_QUESTION>`;

                const ans = await askGemini(prompt);
                push(ans, false, ans);
                sendLog();

            } catch (e) {
                let friendlyError;
                const errorMessage = String(e.message || '');

                if (errorMessage.includes('overloaded')) {
                    friendlyError = lang === 'Russian'
                        ? 'Сервер AI сейчас перегружен большим количеством запросов. Пожалуйста, повторите ваш запрос через минуту.'
                        : 'The AI server is currently overloaded with requests. Please try your request again in a moment.';
                } else if (errorMessage.includes('TIMEOUT')) {
                    friendlyError = lang === 'Russian'
                        ? 'Ваш запрос очень сложный, и AI потребовалось слишком много времени на размышления. Пожалуйста, попробуйте задать тот же вопрос еще раз или немного упростите его.'
                        : 'Your request is very complex and the AI took too long to think. Please try asking the same question again, or try simplifying it a little.';
                } else {
                    friendlyError = errorMessage;
                }

                push(friendlyError, false, friendlyError);
                sendLog();
            }
            setBusy(false);
        }

        /* ── Render ── */
        return React.createElement('div',{className:'flex flex-col h-full'},

            /* KB status bar */
            ks!=='ok' && React.createElement('div',{className:'text-center text-xs text-yellow-400 py-1 flex-shrink-0'},
                ks==='loading'?'Knowledge base loading…':'KB error (check console)'
            ),

            /* Messages area — the ONLY scrollable element */
            React.createElement('div',{className:'flex-1 min-h-0 overflow-y-auto px-4 md:px-8 lg:px-16 py-4'},
                React.createElement('div',{className:'max-w-4xl mx-auto space-y-4'},
                    log.map(m=>React.createElement('div',{key:m.id,className:`flex ${m.user?'justify-end':'justify-start'}`},
                        m.user?
                        React.createElement('div',{
                            className:'max-w-[85%] p-3 rounded-2xl bg-cyan-700 text-white',
                            style:{whiteSpace:'pre-wrap'}
                        },m.txt)
                        :
                        React.createElement('div',{
                            className:`ai-message-bubble max-w-[85%] p-4 rounded-2xl bg-slate-700/80 text-slate-100 ${m.isWelcome?'border border-cyan-500/40':''}`,
                            dangerouslySetInnerHTML:{__html:m.txt}
                        })
                    )),
                    busy&&React.createElement('div',{className:'flex justify-start'},
                        React.createElement('div',{className:'p-4 rounded-2xl bg-slate-700/80 text-slate-300'},
                            React.createElement('span',{className:'inline-flex gap-1'},
                                React.createElement('span',{className:'animate-bounce',style:{animationDelay:'0ms'}},'·'),
                                React.createElement('span',{className:'animate-bounce',style:{animationDelay:'150ms'}},'·'),
                                React.createElement('span',{className:'animate-bounce',style:{animationDelay:'300ms'}},'·')
                            )
                        )
                    ),
                    React.createElement('div',{ref:endRef})
                )
            ),

            /* Input bar — pinned to the bottom */
            React.createElement('div',{className:'flex-shrink-0 border-t border-slate-700/50 bg-gray-900/80 backdrop-blur-sm px-4 md:px-8 lg:px-16 py-3'},
                React.createElement('div',{className:'max-w-4xl mx-auto flex gap-2 items-end'},
                    React.createElement('textarea',{
                        ref:textRef,
                        className:'flex-1 resize-none bg-slate-800 text-slate-50 rounded-xl p-3 focus:outline-none focus:ring-1 focus:ring-cyan-500/50 max-h-40',
                        rows:1,value:inp,placeholder:'Ask about WILL Geometry…',
                        onInput:e=>{setInp(e.target.value);e.target.style.height='auto';e.target.style.height=Math.min(e.target.scrollHeight,160)+'px';},
                        onKeyDown:e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();send();}}
                    }),
                    React.createElement('button',{
                        className:'px-5 py-3 bg-cyan-600 hover:bg-cyan-500 text-white rounded-xl font-medium transition-colors disabled:opacity-40 disabled:hover:bg-cyan-600',
                        disabled:!inp.trim()||busy,onClick:send
                    },'Send')
                )
            )
        );
    }
    ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
</script>
