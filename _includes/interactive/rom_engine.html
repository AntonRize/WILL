<!-- ROM Complete Calculation Engine -->
<div id="rom-root"></div>

<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

<script>
(function() {
  const { useState, useEffect, useRef } = React;
  const { createRoot } = ReactDOM;
  const e = React.createElement;
  
  const G = 6.67430e-11, c = 299792458;
  
  function ROMEngine() {
    const [mode, setMode] = useState('redshift-single');
    
    const [inputs, setInputs] = useState({
      // Redshift single point
      z: 2.12e-6, z_D: 1.967e-4, r_single: 4.6e10,
      // Two-point redshift
      z_D1: 1.967e-4, r_1: 4.6e10, z_D2: 1.5e-4, r_2: 6.98e10,
      // Perihelion state
      kappa_p: 0.1, beta_p: 0.05, r_p_kappa: 4.6e10,
      // Energy + eccentricity - W has NO universal range, it's system-specific!
      W: 5e-9, e_c_W: 0.2, a_W: 5.79e10,
      // Global + eccentricity  
      kappa: 0.0866, e_c_kappa: 0.2, a_kappa: 5.79e10,
      // Apsides + velocity
      r_p_apside: 4.6e10, r_a_apside: 6.98e10, v_p: 58980,
      // Traditional (for reference)
      m0_trad: 1.989e30, r_p_trad: 4.6e10, r_a_trad: 6.98e10,
      // Period-based
      m0_period: 1.989e30, a_period: 5.79e10, T: 7.6e6
    });
    
    const [phase, setPhase] = useState(0);
    const [anim, setAnim] = useState(false);
    const [speed, setSpeed] = useState(1);
    const [prec, setPrec] = useState(true);
    const [orb, setOrb] = useState(0);
    const canvasRef = useRef(null);
    
    const solveROM = () => {
      let kappa_p, beta_p, W, kappa, beta, e_c, a, R_s, m0_derived;
      let derivation_note = "";
      
      if (mode === 'redshift-single') {
        const z = inputs.z;
        const z_D = inputs.z_D;
        const r = inputs.r_single;
        
        kappa = Math.sqrt(1 - 1/(1+z)**2);
        beta = Math.sqrt(1 - 1/(1+z_D)**2);
        
        R_s = kappa**2 * r;
        m0_derived = R_s * c**2 / (2*G);
        
        W = 0.5 * (kappa**2 - beta**2);
        e_c = (2*beta**2/kappa**2) - 1;
        a = R_s / (kappa**2);
        kappa_p = kappa * Math.sqrt(1/(1-e_c));
        beta_p = Math.sqrt(kappa_p**2 * (1+e_c)/2);
        
        derivation_note = "M = (Œ∫¬≤r√óc¬≤)/(2G) where Œ∫¬≤ = 1-1/(1+z)¬≤";
      }
      else if (mode === 'two-point') {
        const z_D1 = inputs.z_D1;
        const z_D2 = inputs.z_D2;
        const r1 = inputs.r_1;
        const r2 = inputs.r_2;
        
        const beta_1_sq = 1 - 1/(1+z_D1)**2;
        const beta_2_sq = 1 - 1/(1+z_D2)**2;
        
        R_s = (r1 * r2) / (r2 - r1) * (beta_1_sq - beta_2_sq);
        m0_derived = R_s * c**2 / (2*G);
        
        const beta_1 = Math.sqrt(beta_1_sq);
        W = 0.5 * (R_s/r1 - beta_1_sq);
        kappa = Math.sqrt(4*W);
        beta = Math.sqrt(2*W);
        a = R_s / (kappa**2);
        e_c = 0.3;
        kappa_p = kappa * Math.sqrt(1/(1-e_c));
        beta_p = Math.sqrt(kappa_p**2 * (1+e_c)/2);
        
        derivation_note = "R_s = (r‚ÇÅr‚ÇÇ)/(r‚ÇÇ-r‚ÇÅ) √ó (Œ≤‚ÇÅ¬≤-Œ≤‚ÇÇ¬≤)";
      }
      else if (mode === 'perihelion') {
        kappa_p = inputs.kappa_p;
        beta_p = inputs.beta_p;
        const r_p = inputs.r_p_kappa;
        
        R_s = kappa_p**2 * r_p;
        m0_derived = R_s * c**2 / (2*G);
        
        W = 0.5 * (kappa_p**2 - beta_p**2);
        kappa = Math.sqrt(4*W);
        beta = Math.sqrt(2*W);
        e_c = (2*beta_p**2/kappa_p**2) - 1;
        a = r_p / (1 - e_c);
        
        derivation_note = "M = (Œ∫‚Çö¬≤r‚Çö√óc¬≤)/(2G)";
      }
      else if (mode === 'energy-ecc') {
        W = inputs.W;
        e_c = inputs.e_c_W;
        a = inputs.a_W;
        
        kappa = Math.sqrt(4*W);
        beta = Math.sqrt(2*W);
        R_s = kappa**2 * a;
        m0_derived = R_s * c**2 / (2*G);
        
        kappa_p = kappa * Math.sqrt(1/(1-e_c));
        beta_p = Math.sqrt(kappa_p**2 * (1+e_c)/2);
        
        derivation_note = "M = (4W√óa√óc¬≤)/(2G)";
      }
      else if (mode === 'global-ecc') {
        kappa = inputs.kappa;
        e_c = inputs.e_c_kappa;
        a = inputs.a_kappa;
        
        R_s = kappa**2 * a;
        m0_derived = R_s * c**2 / (2*G);
        
        W = kappa**2 / 4;
        beta = Math.sqrt(2*W);
        kappa_p = kappa * Math.sqrt(1/(1-e_c));
        beta_p = Math.sqrt(kappa_p**2 * (1+e_c)/2);
        
        derivation_note = "M = (Œ∫¬≤a√óc¬≤)/(2G)";
      }
      else if (mode === 'apsides-velocity') {
        const r_p = inputs.r_p_apside;
        const r_a = inputs.r_a_apside;
        const v_p = inputs.v_p;
        
        a = (r_p + r_a) / 2;
        e_c = (r_a - r_p) / (r_a + r_p);
        beta_p = v_p / c;
        
        kappa_p = Math.sqrt(2*beta_p**2 / (1+e_c));
        R_s = kappa_p**2 * r_p;
        m0_derived = R_s * c**2 / (2*G);
        
        W = 0.5 * (kappa_p**2 - beta_p**2);
        kappa = Math.sqrt(4*W);
        beta = Math.sqrt(2*W);
        
        derivation_note = "Œ∫‚Çö from closure, M = (Œ∫‚Çö¬≤r‚Çö√óc¬≤)/(2G)";
      }
      else if (mode === 'traditional') {
        m0_derived = inputs.m0_trad;
        const r_p = inputs.r_p_trad;
        const r_a = inputs.r_a_trad;
        
        a = (r_p + r_a) / 2;
        e_c = (r_a - r_p) / (r_a + r_p);
        R_s = 2*G*m0_derived / (c**2);
        kappa = Math.sqrt(R_s / a);
        kappa_p = kappa * Math.sqrt(1/(1-e_c));
        beta_p = Math.sqrt(kappa_p**2 * (1+e_c)/2);
        W = 0.5 * (kappa_p**2 - beta_p**2);
        beta = Math.sqrt(2*W);
        
        derivation_note = "Given M, compute ROM parameters";
      }
      else if (mode === 'period') {
        m0_derived = inputs.m0_period;
        a = inputs.a_period;
        const T = inputs.T;
        
        R_s = 2*G*m0_derived / (c**2);
        kappa = Math.sqrt(R_s / a);
        const omega = 2*Math.PI / T;
        beta = omega * a / c;
        W = 0.5 * (kappa**2 - beta**2);
        kappa_p = Math.sqrt(2*W + beta**2);
        e_c = 1 - kappa**2/kappa_p**2;
        beta_p = Math.sqrt(kappa_p**2 * (1+e_c)/2);
        
        derivation_note = "Given M and T, compute ROM parameters";
      }
      
      const delta = kappa_p**2 / (2 * beta_p**2);
      const e_cY = Math.sqrt(Math.abs(1 - e_c**2));
      const r_p = a * (1-e_c);
      const r_a = a * (1+e_c);
      const omega = beta * c / a;
      const T = 2 * Math.PI / omega;
      const Delta_phi = (3*Math.PI/2) * (kappa_p**4 / beta_p**2);
      
      return { kappa_p, beta_p, kappa, beta, W, e_c, delta, e_cY, a, R_s, r_p, r_a, omega, T, Delta_phi, m0_derived, derivation_note };
    };
    
    const state = solveROM();
    
    const calcPhase = (o) => {
      const r_o = state.a * (1 - state.e_c**2) / (1 + state.e_c * Math.cos(o));
      const eta = r_o / state.a;
      const kappa_o = state.kappa_p * Math.sqrt((1 + state.e_c*Math.cos(o)) / (1+state.e_c));
      const beta_o = Math.sqrt(Math.max(0, kappa_o**2 - 2*state.W));
      const delta_o = beta_o > 0 ? kappa_o**2 / (2 * beta_o**2) : 0;
      return { eta, kappa_o, beta_o, delta_o };
    };
    
    useEffect(() => {
      if (!anim) return;
      const timer = setInterval(() => {
        setPhase(p => {
          let np = p + 0.02 * speed;
          if (np >= 2*Math.PI) {
            np = np % (2*Math.PI);
            setOrb(n => n + 1);
          }
          return np;
        });
      }, 16);
      return () => clearInterval(timer);
    }, [anim, speed]);
    
    useEffect(() => {
      const canvas = canvasRef.current;
      if (!canvas || !state.a) return;
      const ctx = canvas.getContext('2d');
      const w = 600, h = 600, cx = w/2, cy = h/2;
      
      ctx.fillStyle = '#0f172a';
      ctx.fillRect(0, 0, w, h);
      
      const scale = 200;
      const orbits = prec ? orb + 1 : 1;
      
      for (let o = 0; o < Math.min(orbits, 10); o++) {
        const precAngle = o * state.Delta_phi;
        ctx.beginPath();
        ctx.strokeStyle = o === orb ? '#60a5fa' : `rgba(96,165,250,${0.3-o*0.03})`;
        ctx.lineWidth = o === orb ? 2 : 1;
        
        for (let ang = 0; ang <= 2*Math.PI; ang += 0.02) {
          const ps = calcPhase(ang);
          const r = ps.eta * scale;
          const tot = ang + precAngle;
          const x = cx + r * Math.cos(tot);
          const y = cy + r * Math.sin(tot);
          if (ang === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        }
        ctx.stroke();
      }
      
      const cur = calcPhase(phase);
      const totAng = phase + (prec ? orb * state.Delta_phi : 0);
      
      ctx.beginPath();
      ctx.arc(cx + cur.eta*scale*Math.cos(totAng), cy + cur.eta*scale*Math.sin(totAng), 5, 0, 2*Math.PI);
      ctx.fillStyle = '#ef4444';
      ctx.fill();
      
      ctx.beginPath();
      ctx.arc(cx, cy, 8, 0, 2*Math.PI);
      ctx.fillStyle = '#fbbf24';
      ctx.fill();
      
      const pAng = prec ? orb * state.Delta_phi : 0;
      ctx.beginPath();
      ctx.arc(cx + (state.r_p/state.a)*scale*Math.cos(pAng), cy + (state.r_p/state.a)*scale*Math.sin(pAng), 3, 0, 2*Math.PI);
      ctx.fillStyle = '#10b981';
      ctx.fill();
      
      ctx.beginPath();
      ctx.arc(cx + (state.r_a/state.a)*scale*Math.cos(pAng+Math.PI), cy + (state.r_a/state.a)*scale*Math.sin(pAng+Math.PI), 3, 0, 2*Math.PI);
      ctx.fillStyle = '#8b5cf6';
      ctx.fill();
    }, [state, phase, orb, prec]);
    
    const cur = calcPhase(phase);
    
    // Input component that accepts scientific notation
    const inp = (label, key, unit, description) => {
      const val = inputs[key];
      const [editVal, setEditVal] = useState(val.toString());
      
      const handleChange = (newStr) => {
        setEditVal(newStr);
        const parsed = parseFloat(newStr);
        if (!isNaN(parsed) && isFinite(parsed)) {
          setInputs({...inputs, [key]: parsed});
        }
      };
      
      const formatDisplay = (v) => {
        if (Math.abs(v) < 0.001 || Math.abs(v) > 1e6) {
          return v.toExponential(6);
        }
        return v.toPrecision(7);
      };
      
      return e('div', { className: 'mb-4 p-3 bg-slate-700/30 rounded-lg border border-slate-600' },
        e('div', { className: 'flex justify-between items-start mb-2' },
          e('div', { className: 'flex-1' },
            e('label', { className: 'text-gray-200 text-sm font-semibold block' }, label),
            description && e('p', { className: 'text-gray-400 text-xs mt-1' }, description)
          ),
          unit && e('span', { className: 'text-gray-400 text-xs ml-2' }, unit)
        ),
        e('input', {
          type: 'text',
          value: editVal,
          onChange: ev => handleChange(ev.target.value),
          onBlur: () => setEditVal(formatDisplay(val)),
          placeholder: 'e.g., 1.5e26 or 0.000123',
          className: 'w-full px-3 py-2 border border-slate-500 rounded bg-slate-800 text-white font-mono text-sm focus:border-blue-500 focus:outline-none'
        }),
        e('div', { className: 'mt-1 text-xs text-gray-500' },
          'Current: ' + formatDisplay(val)
        )
      );
    };
    
    const renderInputs = () => {
      if (mode === 'redshift-single') {
        return e('div', null,
          e('div', { className: 'mb-4 p-3 bg-purple-900/20 border-l-4 border-purple-400 rounded-r' },
            e('p', { className: 'text-purple-200 text-xs font-semibold' }, 'üî¥üîµ PURE OPTICAL METHOD'),
            e('p', { className: 'text-purple-300 text-xs mt-1' }, 'Œ∫¬≤ = 1-1/(1+z)¬≤, Œ≤¬≤ = 1-1/(1+z_D)¬≤')
          ),
          inp('z', 'z', '', 'Gravitational redshift'),
          inp('z_D', 'z_D', '', 'Transverse Doppler shift'),
          inp('r', 'r_single', 'm', 'Distance from center')
        );
      }
      else if (mode === 'two-point') {
        return e('div', null,
          e('div', { className: 'mb-4 p-3 bg-green-900/20 border-l-4 border-green-400 rounded-r' },
            e('p', { className: 'text-green-200 text-xs font-semibold' }, 'üéØ TWO-POINT FORMULA'),
            e('p', { className: 'text-green-300 text-xs mt-1' }, 'R_s = (r‚ÇÅr‚ÇÇ)/(r‚ÇÇ-r‚ÇÅ) √ó (Œ≤‚ÇÅ¬≤-Œ≤‚ÇÇ¬≤)')
          ),
          inp('z_D1', 'z_D1', '', 'Doppler shift at point 1'),
          inp('r‚ÇÅ', 'r_1', 'm', 'Distance to point 1'),
          inp('z_D2', 'z_D2', '', 'Doppler shift at point 2'),
          inp('r‚ÇÇ', 'r_2', 'm', 'Distance to point 2')
        );
      }
      else if (mode === 'perihelion') {
        return e('div', null,
          e('div', { className: 'mb-4 p-3 bg-blue-900/20 border-l-4 border-blue-400 rounded-r' },
            e('p', { className: 'text-blue-200 text-xs font-semibold' }, 'üìê PERIHELION STATE'),
            e('p', { className: 'text-blue-300 text-xs mt-1' }, 'Direct from projections at closest approach')
          ),
          inp('Œ∫‚Çö', 'kappa_p', '', 'Potential projection at perihelion'),
          inp('Œ≤‚Çö', 'beta_p', '', 'Kinetic projection at perihelion'),
          inp('r‚Çö', 'r_p_kappa', 'm', 'Perihelion radius')
        );
      }
      else if (mode === 'energy-ecc') {
        return e('div', null,
          e('div', { className: 'mb-4 p-3 bg-cyan-900/20 border-l-4 border-cyan-400 rounded-r' },
            e('p', { className: 'text-cyan-200 text-xs font-semibold' }, '‚ö° ENERGY & SHAPE'),
            e('p', { className: 'text-cyan-300 text-xs mt-1' }, 'W is system-specific binding energy projection')
          ),
          inp('W', 'W', '', 'Energy invariant W = ¬Ω(Œ∫¬≤-Œ≤¬≤)'),
          inp('e_c', 'e_c_W', '', 'Eccentricity (0 = circle, <1 = ellipse)'),
          inp('a', 'a_W', 'm', 'Semi-major axis')
        );
      }
      else if (mode === 'global-ecc') {
        return e('div', null,
          e('div', { className: 'mb-4 p-3 bg-indigo-900/20 border-l-4 border-indigo-400 rounded-r' },
            e('p', { className: 'text-indigo-200 text-xs font-semibold' }, 'üåê GLOBAL STATE'),
            e('p', { className: 'text-indigo-300 text-xs mt-1' }, 'Average potential at semi-major axis')
          ),
          inp('Œ∫', 'kappa', '', 'Global potential projection'),
          inp('e_c', 'e_c_kappa', '', 'Eccentricity'),
          inp('a', 'a_kappa', 'm', 'Semi-major axis')
        );
      }
      else if (mode === 'apsides-velocity') {
        return e('div', null,
          e('div', { className: 'mb-4 p-3 bg-amber-900/20 border-l-4 border-amber-400 rounded-r' },
            e('p', { className: 'text-amber-200 text-xs font-semibold' }, 'üéØ APSIDES + VELOCITY'),
            e('p', { className: 'text-amber-300 text-xs mt-1' }, 'Reconstructs Œ∫ from closure: Œ∫‚Çö = ‚àö(2Œ≤‚Çö¬≤/(1+e))')
          ),
          inp('r‚Çö', 'r_p_apside', 'm', 'Perihelion distance'),
          inp('r‚Çê', 'r_a_apside', 'm', 'Aphelion distance'),
          inp('v‚Çö', 'v_p', 'm/s', 'Velocity at perihelion')
        );
      }
      else if (mode === 'traditional') {
        return e('div', null,
          e('div', { className: 'mb-4 p-3 bg-gray-700/20 border-l-4 border-gray-400 rounded-r' },
            e('p', { className: 'text-gray-200 text-xs font-semibold' }, 'üìö TRADITIONAL'),
            e('p', { className: 'text-gray-300 text-xs mt-1' }, 'Converts classical parameters to ROM')
          ),
          inp('m‚ÇÄ', 'm0_trad', 'kg', 'Central body mass'),
          inp('r‚Çö', 'r_p_trad', 'm', 'Perihelion'),
          inp('r‚Çê', 'r_a_trad', 'm', 'Aphelion')
        );
      }
      else if (mode === 'period') {
        return e('div', null,
          e('div', { className: 'mb-4 p-3 bg-gray-700/20 border-l-4 border-gray-400 rounded-r' },
            e('p', { className: 'text-gray-200 text-xs font-semibold' }, '‚è±Ô∏è PERIOD-BASED'),
            e('p', { className: 'text-gray-300 text-xs mt-1' }, 'From orbital period observation')
          ),
          inp('m‚ÇÄ', 'm0_period', 'kg', 'Central body mass'),
          inp('a', 'a_period', 'm', 'Semi-major axis'),
          inp('T', 'T', 's', 'Orbital period')
        );
      }
    };
    
    return e('div', { className: 'w-full bg-slate-900 p-4' },
      e('div', { className: 'max-w-7xl mx-auto' },
        e('div', { className: 'bg-slate-800 rounded-xl p-6 mb-6 border-t-4 border-blue-500' },
          e('h1', { className: 'text-3xl font-bold text-white mb-2' }, 'ROM Calculation Engine'),
          e('p', { className: 'text-gray-300 text-sm' }, 'Complete algebraic orbital calculator - mass derived from optical measurements')
        ),
        
        e('div', { className: 'grid grid-cols-1 lg:grid-cols-3 gap-4' },
          // LEFT COLUMN
          e('div', { className: 'space-y-4' },
            e('div', { className: 'bg-slate-800 rounded-lg p-4 border border-slate-700' },
              e('h2', { className: 'text-lg font-semibold mb-3 text-white' }, '‚öôÔ∏è Input Mode'),
              e('select', {
                value: mode,
                onChange: ev => setMode(ev.target.value),
                className: 'w-full px-3 py-2 mb-4 border border-slate-600 rounded-lg bg-slate-700 text-white text-sm'
              },
                e('optgroup', { label: 'üî¥üîµ OPTICAL (Primary)' },
                  e('option', { value: 'redshift-single' }, '(z, z_D, r) Redshift'),
                  e('option', { value: 'two-point' }, '(z_D1, r‚ÇÅ, z_D2, r‚ÇÇ) Two-Point')
                ),
                e('optgroup', { label: 'üìê ROM' },
                  e('option', { value: 'perihelion' }, '(Œ∫‚Çö, Œ≤‚Çö, r‚Çö) Perihelion'),
                  e('option', { value: 'energy-ecc' }, '(W, e, a) Energy'),
                  e('option', { value: 'global-ecc' }, '(Œ∫, e, a) Global')
                ),
                e('optgroup', { label: 'üî≠ ASTROPHYSICAL' },
                  e('option', { value: 'apsides-velocity' }, '(r‚Çö, r‚Çê, v‚Çö) Apsides'),
                  e('option', { value: 'traditional' }, '(m‚ÇÄ, r‚Çö, r‚Çê) Traditional'),
                  e('option', { value: 'period' }, '(m‚ÇÄ, a, T) Period')
                )
              ),
              renderInputs()
            ),
            
            e('div', { className: 'bg-slate-800 rounded-lg p-4 border border-slate-700' },
              e('h2', { className: 'text-lg font-semibold mb-3 text-white' }, 'üé¨ Animation'),
              e('button', {
                onClick: () => setAnim(!anim),
                className: 'w-full px-4 py-2 rounded-lg font-medium mb-2 text-white ' + (anim ? 'bg-red-600' : 'bg-green-600')
              }, anim ? '‚è∏ Pause' : '‚ñ∂ Play'),
              e('div', { className: 'mb-2' },
                e('label', { className: 'block text-gray-300 text-sm mb-1' }, 'Speed: ' + speed.toFixed(1) + 'x'),
                e('input', { type: 'range', min: 0.1, max: 5, step: 0.1, value: speed,
                  onChange: ev => setSpeed(parseFloat(ev.target.value)),
                  className: 'w-full accent-blue-500' })
              ),
              e('div', { className: 'flex items-center p-2 bg-slate-700/50 rounded mb-2' },
                e('input', { type: 'checkbox', checked: prec,
                  onChange: ev => setPrec(ev.target.checked),
                  className: 'mr-2 accent-blue-500' }),
                e('label', { className: 'text-sm text-gray-300' }, 'Precession (#' + orb + ')')
              ),
              e('button', {
                onClick: () => { setPhase(0); setOrb(0); },
                className: 'w-full px-4 py-2 bg-slate-700 rounded-lg text-gray-200'
              }, 'üîÑ Reset')
            ),
            
            e('div', { className: 'bg-slate-800 rounded-lg p-4 border-l-4 border-blue-500' },
              e('h3', { className: 'text-white font-semibold mb-2' }, 'Phase o = ' + (phase*180/Math.PI).toFixed(1) + '¬∞'),
              e('div', { className: 'text-sm space-y-1' },
                e('div', { className: 'flex justify-between p-1 bg-slate-700/50 rounded' },
                  e('span', { className: 'text-gray-400' }, 'Œ∑:'),
                  e('span', { className: 'text-blue-400 font-mono text-xs' }, cur.eta.toPrecision(6))
                ),
                e('div', { className: 'flex justify-between p-1 bg-slate-700/50 rounded' },
                  e('span', { className: 'text-gray-400' }, 'Œ∫‚ÇÄ:'),
                  e('span', { className: 'text-blue-400 font-mono text-xs' }, cur.kappa_o.toPrecision(6))
                ),
                e('div', { className: 'flex justify-between p-1 bg-slate-700/50 rounded' },
                  e('span', { className: 'text-gray-400' }, 'Œ≤‚ÇÄ:'),
                  e('span', { className: 'text-red-400 font-mono text-xs' }, cur.beta_o.toPrecision(6))
                ),
                e('div', { className: 'flex justify-between p-1 bg-slate-700/50 rounded' },
                  e('span', { className: 'text-gray-400' }, 'Œ¥‚ÇÄ:'),
                  e('span', { className: 'text-purple-400 font-mono text-xs' }, cur.delta_o.toPrecision(6))
                )
              )
            )
          ),
          
          // RIGHT COLUMN
          e('div', { className: 'lg:col-span-2 space-y-4' },
            e('div', { className: 'bg-slate-800 rounded-lg p-4 border border-slate-700' },
              e('h2', { className: 'text-lg font-semibold mb-3 text-white' }, 'üåÄ Orbit (Normalized)'),
              e('canvas', { ref: canvasRef, width: 600, height: 600, 
                className: 'w-full border-2 border-slate-600 rounded-lg bg-slate-950' }),
              e('div', { className: 'mt-2 text-xs text-gray-400 flex justify-around' },
                e('span', null, 'üü° Central'),
                e('span', null, 'üü¢ Perihelion'),
                e('span', null, 'üü£ Aphelion'),
                e('span', null, 'üî¥ Current')
              )
            ),
            
            e('div', { className: 'bg-slate-800 rounded-lg p-4 border border-slate-700' },
              e('h2', { className: 'text-white font-semibold mb-3' }, 'üìä Complete ROM State'),
              
              e('div', { className: 'mb-4 p-4 bg-gradient-to-r from-yellow-900/30 to-orange-900/30 border-2 border-yellow-500/50 rounded-lg' },
                e('div', { className: 'grid grid-cols-2 gap-4' },
                  e('div', null,
                    e('p', { className: 'text-yellow-200 text-xs font-semibold' }, 'DERIVED MASS:'),
                    e('p', { className: 'text-yellow-100 text-lg font-bold font-mono' }, 
                      state.m0_derived.toExponential(6) + ' kg'
                    ),
                    e('p', { className: 'text-yellow-300 text-xs mt-1' }, 
                      (state.m0_derived/1.989e30).toPrecision(5) + ' M‚òâ'
                    )
                  ),
                  e('div', { className: 'text-right' },
                    e('p', { className: 'text-yellow-300 text-xs' }, 'R_s = ' + state.R_s.toExponential(4) + ' m'),
                    e('p', { className: 'text-yellow-400 text-xs mt-1 italic' }, state.derivation_note)
                  )
                )
              ),
              
              e('div', { className: 'grid grid-cols-2 md:grid-cols-5 gap-3 text-xs' },
                e('div', null,
                  e('h4', { className: 'text-blue-400 font-semibold mb-1' }, 'Global'),
                  e('div', { className: 'space-y-1 mt-2' },
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'Œ∫:'),
                      e('span', { className: 'text-gray-200 font-mono' }, state.kappa.toExponential(4))
                    ),
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'Œ≤:'),
                      e('span', { className: 'text-gray-200 font-mono' }, state.beta.toExponential(4))
                    ),
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'W:'),
                      e('span', { className: 'text-gray-200 font-mono' }, state.W.toExponential(4))
                    )
                  )
                ),
                e('div', null,
                  e('h4', { className: 'text-green-400 font-semibold mb-1' }, 'Perihelion'),
                  e('div', { className: 'space-y-1 mt-2' },
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'Œ∫‚Çö:'),
                      e('span', { className: 'text-gray-200 font-mono' }, state.kappa_p.toExponential(4))
                    ),
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'Œ≤‚Çö:'),
                      e('span', { className: 'text-gray-200 font-mono' }, state.beta_p.toExponential(4))
                    ),
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'r‚Çö:'),
                      e('span', { className: 'text-gray-200 font-mono' }, state.r_p.toExponential(3) + ' m')
                    )
                  )
                ),
                e('div', null,
                  e('h4', { className: 'text-purple-400 font-semibold mb-1' }, 'Shape'),
                  e('div', { className: 'space-y-1 mt-2' },
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'e_c:'),
                      e('span', { className: 'text-gray-200 font-mono' }, state.e_c.toPrecision(6))
                    ),
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'Œ¥:'),
                      e('span', { className: 'text-gray-200 font-mono' }, state.delta.toPrecision(6))
                    ),
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'r‚Çê:'),
                      e('span', { className: 'text-gray-200 font-mono' }, state.r_a.toExponential(3) + ' m')
                    )
                  )
                ),
                e('div', null,
                  e('h4', { className: 'text-cyan-400 font-semibold mb-1' }, 'System'),
                  e('div', { className: 'space-y-1 mt-2' },
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'a:'),
                      e('span', { className: 'text-gray-200 font-mono' }, state.a.toExponential(3) + ' m')
                    ),
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'T:'),
                      e('span', { className: 'text-gray-200 font-mono' }, state.T.toExponential(3) + ' s')
                    ),
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'T:'),
                      e('span', { className: 'text-gray-200 font-mono' }, (state.T/31557600).toPrecision(4) + ' yr')
                    )
                  )
                ),
                e('div', null,
                  e('h4', { className: 'text-orange-400 font-semibold mb-1' }, 'Precession'),
                  e('div', { className: 'space-y-1 mt-2' },
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'ŒîœÜ:'),
                      e('span', { className: 'text-gray-200 font-mono' }, state.Delta_phi.toExponential(4) + ' rad')
                    ),
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'ŒîœÜ:'),
                      e('span', { className: 'text-gray-200 font-mono' }, (state.Delta_phi*180/Math.PI).toExponential(4) + '¬∞')
                    ),
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'ŒîœÜ:'),
                      e('span', { className: 'text-gray-200 font-mono' }, (state.Delta_phi*206265).toPrecision(5) + '"')
                    )
                  )
                )
              )
            )
          )
        )
      )
    );
  }
  
  const root = createRoot(document.getElementById('rom-root'));
  root.render(e(ROMEngine));
})();
</script>
