<!-- ROM Interactive Engine -->
<div id="rom-root"></div>

<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

<script>
(function() {
  const { useState, useEffect, useRef } = React;
  const { createRoot } = ReactDOM;
  const e = React.createElement;
  
  function ROMEngine() {
    const G = 6.67430e-11, c = 299792458;
    const [kappa_p, setKappaP] = useState(0.1);
    const [beta_p, setBetaP] = useState(0.05);
    const [phase, setPhase] = useState(0);
    const [animating, setAnimating] = useState(false);
    const [speed, setSpeed] = useState(1);
    const [showPrec, setShowPrec] = useState(true);
    const [orbitN, setOrbitN] = useState(0);
    const canvasRef = useRef(null);
    
    const W = 0.5 * (kappa_p ** 2 - beta_p ** 2);
    const kappa = Math.sqrt(4 * W);
    const beta = Math.sqrt(2 * W);
    const e_c = (2 * beta_p ** 2 / kappa_p ** 2) - 1;
    const delta = kappa_p / (beta_p * Math.sqrt(2));
    const e_cY = Math.sqrt(1 - e_c ** 2);
    const a = 1.0;
    const R_s = kappa ** 2 * a;
    const r_p = a * (1 - e_c);
    const r_a = a * (1 + e_c);
    const omega = beta * c / a;
    const T = 2 * Math.PI / omega;
    const Delta_phi = (3 * Math.PI / 2) * (kappa_p ** 4 / beta_p ** 2);
    
    const calcPhase = (o) => {
      const r_o = a * (1 - e_c ** 2) / (1 + e_c * Math.cos(o));
      const eta = r_o / a;
      const kappa_o = kappa_p * Math.sqrt((1 + e_c * Math.cos(o)) / (1 + e_c));
      const beta_o = Math.sqrt(Math.max(0, kappa_o ** 2 - 2 * W));
      return { eta, kappa_o, beta_o };
    };
    
    useEffect(() => {
      if (!animating) return;
      const timer = setInterval(() => {
        setPhase(p => {
          let np = p + 0.02 * speed;
          if (np >= 2 * Math.PI) {
            np = np % (2 * Math.PI);
            setOrbitN(n => n + 1);
          }
          return np;
        });
      }, 16);
      return () => clearInterval(timer);
    }, [animating, speed]);
    
    useEffect(() => {
      const canvas = canvasRef.current;
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      const w = 600, h = 600, cx = w/2, cy = h/2;
      
      ctx.fillStyle = '#0f172a';
      ctx.fillRect(0, 0, w, h);
      
      const scale = 200;
      const orbits = showPrec ? orbitN + 1 : 1;
      
      for (let orb = 0; orb < Math.min(orbits, 10); orb++) {
        const prec = orb * Delta_phi;
        ctx.beginPath();
        ctx.strokeStyle = orb === orbitN ? '#60a5fa' : `rgba(96,165,250,${0.3-orb*0.03})`;
        ctx.lineWidth = orb === orbitN ? 2 : 1;
        
        for (let ang = 0; ang <= 2*Math.PI; ang += 0.02) {
          const ps = calcPhase(ang);
          const r = ps.eta * scale;
          const tot = ang + prec;
          const x = cx + r * Math.cos(tot);
          const y = cy + r * Math.sin(tot);
          if (ang === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        }
        ctx.stroke();
      }
      
      const cur = calcPhase(phase);
      const totAng = phase + (showPrec ? orbitN * Delta_phi : 0);
      
      ctx.beginPath();
      ctx.arc(cx + cur.eta*scale*Math.cos(totAng), cy + cur.eta*scale*Math.sin(totAng), 5, 0, 2*Math.PI);
      ctx.fillStyle = '#ef4444';
      ctx.fill();
      
      ctx.beginPath();
      ctx.arc(cx, cy, 8, 0, 2*Math.PI);
      ctx.fillStyle = '#fbbf24';
      ctx.fill();
      
      const pAng = showPrec ? orbitN * Delta_phi : 0;
      ctx.beginPath();
      ctx.arc(cx + (r_p/a)*scale*Math.cos(pAng), cy + (r_p/a)*scale*Math.sin(pAng), 3, 0, 2*Math.PI);
      ctx.fillStyle = '#10b981';
      ctx.fill();
      
      ctx.beginPath();
      ctx.arc(cx + (r_a/a)*scale*Math.cos(pAng+Math.PI), cy + (r_a/a)*scale*Math.sin(pAng+Math.PI), 3, 0, 2*Math.PI);
      ctx.fillStyle = '#8b5cf6';
      ctx.fill();
    }, [kappa_p, beta_p, phase, orbitN, showPrec]);
    
    const cur = calcPhase(phase);
    
    return e('div', { className: 'w-full bg-slate-900 p-4' },
      e('div', { className: 'max-w-7xl mx-auto' },
        e('div', { className: 'bg-slate-800 rounded-xl p-6 mb-6 border-t-4 border-blue-500' },
          e('h1', { className: 'text-3xl font-bold text-white mb-2' }, 'ROM Interactive Engine'),
          e('p', { className: 'text-gray-300' }, 'Algebraic orbital system - scale invariant')
        ),
        
        e('div', { className: 'grid grid-cols-1 lg:grid-cols-3 gap-4' },
          e('div', { className: 'space-y-4' },
            e('div', { className: 'bg-slate-800 rounded-lg p-4 border border-slate-700' },
              e('h2', { className: 'text-lg font-semibold mb-3 text-white' }, '‚öôÔ∏è Input Parameters'),
              e('div', { className: 'space-y-3' },
                e('div', null,
                  e('label', { className: 'block text-gray-300 text-sm mb-1' }, 'Œ∫‚Çö: ' + kappa_p.toFixed(3)),
                  e('input', {
                    type: 'range', min: 0.001, max: 1, step: 0.001, value: kappa_p,
                    onChange: ev => setKappaP(parseFloat(ev.target.value)),
                    className: 'w-full accent-blue-500'
                  })
                ),
                e('div', null,
                  e('label', { className: 'block text-gray-300 text-sm mb-1' }, 'Œ≤‚Çö: ' + beta_p.toFixed(3)),
                  e('input', {
                    type: 'range', min: 0.001, max: 0.99, step: 0.001, value: beta_p,
                    onChange: ev => setBetaP(parseFloat(ev.target.value)),
                    className: 'w-full accent-blue-500'
                  })
                )
              )
            ),
            
            e('div', { className: 'bg-slate-800 rounded-lg p-4 border border-slate-700' },
              e('h2', { className: 'text-lg font-semibold mb-3 text-white' }, 'üé¨ Animation'),
              e('button', {
                onClick: () => setAnimating(!animating),
                className: 'w-full px-4 py-2 rounded-lg font-medium mb-2 ' + (animating ? 'bg-red-600' : 'bg-green-600')
              }, animating ? '‚è∏ Pause' : '‚ñ∂ Play'),
              e('div', { className: 'mb-2' },
                e('label', { className: 'block text-gray-300 text-sm mb-1' }, 'Speed: ' + speed.toFixed(1) + 'x'),
                e('input', {
                  type: 'range', min: 0.1, max: 5, step: 0.1, value: speed,
                  onChange: ev => setSpeed(parseFloat(ev.target.value)),
                  className: 'w-full accent-blue-500'
                })
              ),
              e('div', { className: 'flex items-center p-2 bg-slate-700/50 rounded mb-2' },
                e('input', {
                  type: 'checkbox', checked: showPrec,
                  onChange: ev => setShowPrec(ev.target.checked),
                  className: 'mr-2 accent-blue-500'
                }),
                e('label', { className: 'text-sm text-gray-300' }, 'Precession (Orbit #' + orbitN + ')')
              ),
              e('button', {
                onClick: () => { setPhase(0); setOrbitN(0); },
                className: 'w-full px-4 py-2 bg-slate-700 rounded-lg text-gray-200'
              }, 'üîÑ Reset')
            ),
            
            e('div', { className: 'bg-slate-800 rounded-lg p-4 border-l-4 border-blue-500' },
              e('h3', { className: 'text-white font-semibold mb-2' }, 'Current Phase'),
              e('div', { className: 'text-sm space-y-1' },
                e('div', { className: 'flex justify-between p-1 bg-slate-700/50 rounded' },
                  e('span', { className: 'text-gray-400' }, 'Œ∑:'),
                  e('span', { className: 'text-blue-400 font-mono' }, cur.eta.toFixed(4))
                ),
                e('div', { className: 'flex justify-between p-1 bg-slate-700/50 rounded' },
                  e('span', { className: 'text-gray-400' }, 'Œ∫‚ÇÄ:'),
                  e('span', { className: 'text-blue-400 font-mono' }, cur.kappa_o.toFixed(4))
                ),
                e('div', { className: 'flex justify-between p-1 bg-slate-700/50 rounded' },
                  e('span', { className: 'text-gray-400' }, 'Œ≤‚ÇÄ:'),
                  e('span', { className: 'text-red-400 font-mono' }, cur.beta_o.toFixed(4))
                )
              )
            )
          ),
          
          e('div', { className: 'lg:col-span-2 space-y-4' },
            e('div', { className: 'bg-slate-800 rounded-lg p-4 border border-slate-700' },
              e('h2', { className: 'text-lg font-semibold mb-3 text-white' }, 'üåÄ Normalized Orbit'),
              e('canvas', { ref: canvasRef, width: 600, height: 600, className: 'w-full border-2 border-slate-600 rounded-lg' }),
              e('div', { className: 'mt-2 text-sm text-gray-300 flex justify-around' },
                e('span', null, 'üü° Central'),
                e('span', null, 'üü¢ Perihelion'),
                e('span', null, 'üü£ Aphelion'),
                e('span', null, 'üî¥ Current')
              )
            ),
            
            e('div', { className: 'bg-slate-800 rounded-lg p-4 border border-slate-700' },
              e('h2', { className: 'text-white font-semibold mb-3' }, 'üìê ROM State'),
              e('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-4 text-xs' },
                e('div', null,
                  e('h4', { className: 'text-gray-300 font-semibold mb-1' }, 'Global'),
                  e('div', { className: 'space-y-1' },
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'Œ∫:'),
                      e('span', { className: 'text-gray-200 font-mono' }, kappa.toFixed(4))
                    ),
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'Œ≤:'),
                      e('span', { className: 'text-gray-200 font-mono' }, beta.toFixed(4))
                    ),
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'W:'),
                      e('span', { className: 'text-gray-200 font-mono' }, W.toFixed(4))
                    )
                  )
                ),
                e('div', null,
                  e('h4', { className: 'text-gray-300 font-semibold mb-1' }, 'Eccentricity'),
                  e('div', { className: 'space-y-1' },
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'e·¥Ñ:'),
                      e('span', { className: 'text-gray-200 font-mono' }, e_c.toFixed(4))
                    ),
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'Œ¥:'),
                      e('span', { className: 'text-gray-200 font-mono' }, delta.toFixed(4))
                    )
                  )
                ),
                e('div', null,
                  e('h4', { className: 'text-green-400 font-semibold mb-1' }, 'Perihelion'),
                  e('div', { className: 'space-y-1' },
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'Œ∫‚Çö:'),
                      e('span', { className: 'text-gray-200 font-mono' }, kappa_p.toFixed(4))
                    ),
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'Œ≤‚Çö:'),
                      e('span', { className: 'text-gray-200 font-mono' }, beta_p.toFixed(4))
                    )
                  )
                ),
                e('div', null,
                  e('h4', { className: 'text-gray-300 font-semibold mb-1' }, 'Orbit'),
                  e('div', { className: 'space-y-1' },
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'T:'),
                      e('span', { className: 'text-gray-200 font-mono' }, T.toFixed(2))
                    ),
                    e('div', { className: 'flex justify-between' },
                      e('span', { className: 'text-gray-400' }, 'ŒîœÜ:'),
                      e('span', { className: 'text-gray-200 font-mono' }, (Delta_phi*180/Math.PI).toFixed(4) + '¬∞')
                    )
                  )
                )
              )
            )
          )
        )
      )
    );
  }
  
  const root = createRoot(document.getElementById('rom-root'));
  root.render(e(ROMEngine));
})();
</script>
